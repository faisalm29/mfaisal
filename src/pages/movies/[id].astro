---
import { getCollection, getEntry, render } from "astro:content";
import { getMovie } from "../../../lib/tmdb";
import MovieReviewPostLayout from "@layouts/MovieReviewPostLayout.astro";

export async function getStaticPaths() {
  const movies = await getCollection("movies");
  return movies.map((movie) => ({
    params: {
      id: movie.id,
    },
  }));
}

const params = Astro.params;

const movie = await getEntry("movies", params.id);
if (!movie) throw new Error(`Movie not found: ${params.id}`);

const { Content, remarkPluginFrontmatter } = await render(movie);
const movieData = await getMovie(movie.data.imdbId);
---

<MovieReviewPostLayout
  frontmatter={{ ...movieData, ...remarkPluginFrontmatter }}
>
  <Content />
</MovieReviewPostLayout>
