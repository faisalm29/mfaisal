---
import BaseLayout from "@layouts/BaseLayout.astro";
import Summary from "@components/Summary.astro";
import LatestPost from "@components/LatestPost.astro";
import { getCollection } from "astro:content";
import { getMovies } from "../../lib/tmdb";

const social = await getCollection("social");
const allProgrammingPosts = (await getCollection("programming")).map(
  (post) => ({
    id: `/programming/${post.id}`,
    title: post.data.title,
    pubDate: post.data.pubDate,
    category: post.data.category,
  }),
);
const allGeneralPosts = (await getCollection("general")).map((post) => ({
  id: `/blog/${post.id}`,
  title: post.data.title,
  pubDate: post.data.pubDate,
  category: post.data.category,
}));
const movies = await getCollection("movies");
const imdbIds = movies.map((movie) => movie.data.imdbId);
const allMoviePosts = (await getMovies(imdbIds)).map((post) => ({
  id: `/movie/${post.id}`,
  title: post.title,
  pubDate: post.pubDate,
  category: post.category,
}));

const allPosts = [
  ...allProgrammingPosts,
  ...allGeneralPosts,
  ...allMoviePosts,
].sort((a, b) => b.pubDate!.valueOf() - a.pubDate!.valueOf());

const metadata = {
  pageTitle: "Faisal M.",
  description:
    "Hello, I'm Faisal! Here I write about programming, movies, and anything else that interests me.",
};
---

<BaseLayout metadata={metadata}>
  <Summary social={social} />
  <LatestPost allPosts={allPosts} />
</BaseLayout>
